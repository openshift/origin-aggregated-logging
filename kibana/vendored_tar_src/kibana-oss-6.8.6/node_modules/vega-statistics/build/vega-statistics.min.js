!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],t):t(n.vega=n.vega||{},n.d3)}(this,function(n,t){"use strict";function r(n){return null===n?NaN:+n}function e(n){var r=n.length,e=o(n),a=(e[2]-e[0])/1.34;return 1.06*Math.min(Math.sqrt(t.variance(n)),a)*Math.pow(r,-.2)}var a=function(n,t){var e,a=[],o=n.length,u=-1;if(null==t)for(;++u<o;)isNaN(e=r(n[u]))||a.push(e);else for(;++u<o;)isNaN(e=r(t(n[u],u,n)))||a.push(e);return a};n.random=Math.random;var o=function(n,r){var e=a(n,r);return[t.quantile(e.sort(t.ascending),.25),t.quantile(e,.5),t.quantile(e,.75)]},u=function(t,r){var e,a,o=NaN,u={};return u.mean=function(n){return arguments.length?(e=n||0,o=NaN,u):e},u.stdev=function(n){return arguments.length?(a=null==n?1:n,o=NaN,u):a},u.sample=function(){var t,r,u=0,i=0;if(o===o)return u=o,o=NaN,u;do{t=(u=2*n.random()-1)*u+(i=2*n.random()-1)*i}while(0===t||t>1);return r=Math.sqrt(-2*Math.log(t)/t),o=e+i*r*a,e+u*r*a},u.pdf=function(n){var t=Math.exp(Math.pow(n-e,2)/(-2*Math.pow(a,2)));return 1/(a*Math.sqrt(2*Math.PI))*t},u.cdf=function(n){var t,r=(n-e)/a,o=Math.abs(r);if(o>37)t=0;else{var u=Math.exp(-o*o/2);o<7.07106781186547?(t=u*((((((.0352624965998911*o+.700383064443688)*o+6.37396220353165)*o+33.912866078383)*o+112.079291497871)*o+221.213596169931)*o+220.206867912376),t/=((((((.0883883476483184*o+1.75566716318264)*o+16.064177579207)*o+86.7807322029461)*o+296.564248779674)*o+637.333633378831)*o+793.826512519948)*o+440.413735824752):t=u/(o+1/(o+2/(o+3/(o+4/(o+.65)))))/2.506628274631}return r>0?1-t:t},u.icdf=function(n){if(n<=0||n>=1)return NaN;var t=2*n-1,r=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),o=2/(Math.PI*r)+Math.log(1-Math.pow(t,2))/2,u=Math.log(1-t*t)/r,i=(t>0?1:-1)*Math.sqrt(Math.sqrt(o*o-u)-o);return e+a*Math.SQRT2*i},u.mean(t).stdev(r)};n.bin=function(n){var t,r,e,a,o,u,i,f,c=n.maxbins||20,d=n.base||10,h=Math.log(d),l=n.divide||[5,2],s=n.extent[0],p=n.extent[1],M=p-s;if(n.step)t=n.step;else if(n.steps){for(o=M/c,u=0,i=n.steps.length;u<i&&n.steps[u]<o;++u);t=n.steps[Math.max(0,u-1)]}else{for(r=Math.ceil(Math.log(c)/h),e=n.minstep||0,t=Math.max(e,Math.pow(d,Math.round(Math.log(M)/h)-r));Math.ceil(M/t)>c;)t*=d;for(u=0,i=l.length;u<i;++u)(o=t/l[u])>=e&&M/o<=c&&(t=o)}return o=Math.log(t),a=o>=0?0:1+~~(-o/h),f=Math.pow(d,-a-1),(n.nice||void 0===n.nice)&&(s=s<(o=Math.floor(s/t+f)*t)?o-t:o,p=Math.ceil(p/t)*t),{start:s,stop:p,step:t}},n.bootstrapCI=function(r,e,o,u){var i,f,c,d,h=a(r,u),l=h.length,s=e;for(c=0,d=Array(s);c<s;++c){for(i=0,f=0;f<l;++f)i+=h[~~(n.random()*l)];d[c]=i/l}return[t.quantile(d.sort(t.ascending),o/2),t.quantile(d,1-o/2)]},n.quartiles=o,n.setRandom=function(t){n.random=t},n.randomInteger=function(t,r){null==r&&(r=t,t=0);var e,a,o,u={};return u.min=function(n){return arguments.length?(e=n||0,o=a-e,u):e},u.max=function(n){return arguments.length?(a=n||0,o=a-e,u):a},u.sample=function(){return e+Math.floor(o*n.random())},u.pdf=function(n){return n===Math.floor(n)&&n>=e&&n<a?1/o:0},u.cdf=function(n){var t=Math.floor(n);return t<e?0:t>=a?1:(t-e+1)/o},u.icdf=function(n){return n>=0&&n<=1?e-1+Math.floor(n*o):NaN},u.min(t).max(r)},n.randomKDE=function(t,r){var a=u(),o={},i=0;return o.data=function(n){return arguments.length?(t=n,i=n?n.length:0,o.bandwidth(r)):t},o.bandwidth=function(n){return arguments.length?(!(r=n)&&t&&(r=e(t)),o):r},o.sample=function(){return t[~~(n.random()*i)]+r*a.sample()},o.pdf=function(n){for(var e=0,o=0;o<i;++o)e+=a.pdf((n-t[o])/r);return e/r/i},o.cdf=function(n){for(var e=0,o=0;o<i;++o)e+=a.cdf((n-t[o])/r);return e/i},o.icdf=function(){throw Error("KDE icdf not supported.")},o.data(t)},n.randomMixture=function(t,r){function e(n){var t,r=[],e=0;for(t=0;t<u;++t)e+=r[t]=null==n[t]?1:+n[t];for(t=0;t<u;++t)r[t]/=e;return r}var a,o={},u=0;return o.weights=function(n){return arguments.length?(a=e(r=n||[]),o):r},o.distributions=function(n){return arguments.length?(n?(u=n.length,t=n):(u=0,t=[]),o.weights(r)):t},o.sample=function(){for(var r=n.random(),e=t[u-1],o=a[0],i=0;i<u-1;o+=a[++i])if(r<o){e=t[i];break}return e.sample()},o.pdf=function(n){for(var r=0,e=0;e<u;++e)r+=a[e]*t[e].pdf(n);return r},o.cdf=function(n){for(var r=0,e=0;e<u;++e)r+=a[e]*t[e].cdf(n);return r},o.icdf=function(){throw Error("Mixture icdf not supported.")},o.distributions(t).weights(r)},n.randomNormal=u,n.randomUniform=function(t,r){null==r&&(r=null==t?1:t,t=0);var e,a,o,u={};return u.min=function(n){return arguments.length?(e=n||0,o=a-e,u):e},u.max=function(n){return arguments.length?(a=n||0,o=a-e,u):a},u.sample=function(){return e+o*n.random()},u.pdf=function(n){return n>=e&&n<=a?1/o:0},u.cdf=function(n){return n<e?0:n>a?1:(n-e)/o},u.icdf=function(n){return n>=0&&n<=1?e+n*o:NaN},u.min(t).max(r)},Object.defineProperty(n,"__esModule",{value:!0})});