{"remainingRequest":"/Users/chanderprall/projects/eui/node_modules/babel-loader/lib/index.js!/Users/chanderprall/projects/eui/src/components/search_bar/filters/field_value_selection_filter.js","dependencies":[{"path":"/Users/chanderprall/projects/eui/src/components/search_bar/filters/field_value_selection_filter.js","mtime":1565204169977},{"path":"/Users/chanderprall/projects/eui/.babelrc.js","mtime":1565204168946},{"path":"/Users/chanderprall/projects/eui/node_modules/cache-loader/dist/cjs.js","mtime":1555436064329},{"path":"/Users/chanderprall/projects/eui/node_modules/babel-loader/lib/index.js","mtime":1543517280769}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FieldValueSelectionFilter = exports.FieldValueSelectionFilterConfigType = void 0;\n\nrequire(\"core-js/modules/es6.string.iterator\");\n\nrequire(\"core-js/modules/es6.array.from\");\n\nrequire(\"core-js/modules/es7.symbol.async-iterator\");\n\nrequire(\"core-js/modules/es6.symbol\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.array.iterator\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nrequire(\"core-js/modules/es6.object.set-prototype-of\");\n\nrequire(\"core-js/modules/es6.regexp.to-string\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/es6.promise\");\n\nrequire(\"core-js/modules/es6.string.starts-with\");\n\nrequire(\"core-js/modules/es7.array.includes\");\n\nrequire(\"core-js/modules/es6.string.includes\");\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _predicate = require(\"../../../services/predicate\");\n\nvar _services = require(\"../../../services\");\n\nvar _prop_types = require(\"../../../utils/prop_types\");\n\nvar _popover = require(\"../../popover/popover\");\n\nvar _popover_title = require(\"../../popover/popover_title\");\n\nvar _field_search = require(\"../../form/field_search/field_search\");\n\nvar _filter_group = require(\"../../filter_group\");\n\nvar _loading_chart = require(\"../../loading/loading_chart\");\n\nvar _spacer = require(\"../../spacer/spacer\");\n\nvar _icon = require(\"../../icon/icon\");\n\nvar _query3 = require(\"../query\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar FieldValueOptionType = _propTypes.default.shape({\n  field: _propTypes.default.string,\n  value: _propTypes.default.any.isRequired,\n  name: _propTypes.default.string,\n  view: _propTypes.default.node\n});\n\nvar FieldValueOptionsType = _propTypes.default.oneOfType([_propTypes.default.func, // (query) => Promise<FieldValueOptionType[]>\n_propTypes.default.arrayOf(FieldValueOptionType)]);\n\nvar FieldValueSelectionFilterConfigType = _propTypes.default.shape({\n  type: _prop_types.EuiPropTypes.is('field_value_selection').isRequired,\n  field: _propTypes.default.string,\n  autoClose: _propTypes.default.boolean,\n  name: _propTypes.default.string.isRequired,\n  options: FieldValueOptionsType.isRequired,\n  filterWith: _propTypes.default.oneOfType([_propTypes.default.func, _propTypes.default.oneOf(['prefix', 'includes'])]),\n  cache: _propTypes.default.number,\n  multiSelect: _propTypes.default.oneOfType([_propTypes.default.bool, _propTypes.default.oneOf(['and', 'or'])]),\n  loadingMessage: _propTypes.default.string,\n  noOptionsMessage: _propTypes.default.string,\n  searchThreshold: _propTypes.default.number,\n  available: _propTypes.default.func // () => boolean\n\n});\n\nexports.FieldValueSelectionFilterConfigType = FieldValueSelectionFilterConfigType;\nvar FieldValueSelectionFilterPropTypes = {\n  index: _propTypes.default.number.isRequired,\n  config: FieldValueSelectionFilterConfigType.isRequired,\n  query: _propTypes.default.any.isRequired,\n  onChange: _propTypes.default.func.isRequired // (value) => void\n\n};\nvar defaults = {\n  config: {\n    multiSelect: true,\n    filterWith: 'prefix',\n    loadingMessage: 'Loading...',\n    noOptionsMessage: 'No options found',\n    searchThreshold: 10\n  }\n};\n\nvar FieldValueSelectionFilter =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(FieldValueSelectionFilter, _Component);\n\n  function FieldValueSelectionFilter(props) {\n    var _this;\n\n    _classCallCheck(this, FieldValueSelectionFilter);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(FieldValueSelectionFilter).call(this, props));\n    var options = props.config.options;\n    var preloadedOptions = (0, _predicate.isArray)(options) ? {\n      all: options,\n      shown: options\n    } : null;\n    _this.selectItems = [];\n    _this.state = {\n      popoverOpen: false,\n      error: null,\n      options: preloadedOptions\n    };\n    return _this;\n  }\n\n  _createClass(FieldValueSelectionFilter, [{\n    key: \"closePopover\",\n    value: function closePopover() {\n      this.setState({\n        popoverOpen: false\n      });\n    }\n  }, {\n    key: \"onButtonClick\",\n    value: function onButtonClick() {\n      var _this2 = this;\n\n      this.setState(function (prevState) {\n        if (!prevState.popoverOpen) {\n          // loading options updates the state, so we'll do that in the animation frame\n          window.requestAnimationFrame(function () {\n            _this2.loadOptions();\n          });\n        }\n\n        return {\n          options: null,\n          error: null,\n          popoverOpen: !prevState.popoverOpen\n        };\n      });\n    }\n  }, {\n    key: \"loadOptions\",\n    value: function loadOptions() {\n      var _this3 = this;\n\n      var loader = this.resolveOptionsLoader();\n      this.setState({\n        options: null,\n        error: null\n      });\n      loader().then(function (options) {\n        _this3.setState({\n          error: null,\n          options: {\n            all: options,\n            shown: options\n          }\n        });\n      }).catch(function () {\n        _this3.setState({\n          options: null,\n          error: 'Could not load options'\n        });\n      });\n    }\n  }, {\n    key: \"filterOptions\",\n    value: function filterOptions() {\n      var _this4 = this;\n\n      var q = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      this.setState(function (prevState) {\n        if ((0, _predicate.isNil)(prevState.options)) {\n          return {};\n        }\n\n        var predicate = _this4.getOptionFilter();\n\n        return {\n          options: _objectSpread({}, prevState.options, {\n            shown: prevState.options.all.filter(function (option, i, options) {\n              var name = _this4.resolveOptionName(option).toLowerCase();\n\n              var query = q.toLowerCase();\n              return predicate(name, query, options);\n            })\n          })\n        };\n      });\n    }\n  }, {\n    key: \"getOptionFilter\",\n    value: function getOptionFilter() {\n      var filterWith = this.props.config.filterWith || defaults.config.filterWith;\n\n      if (typeof filterWith === 'function') {\n        return filterWith;\n      }\n\n      if (filterWith === 'includes') {\n        return function (name, query) {\n          return name.includes(query);\n        };\n      }\n\n      return function (name, query) {\n        return name.startsWith(query);\n      };\n    }\n  }, {\n    key: \"resolveOptionsLoader\",\n    value: function resolveOptionsLoader() {\n      var _this5 = this;\n\n      var options = this.props.config.options;\n\n      if ((0, _predicate.isArray)(options)) {\n        return function () {\n          return Promise.resolve(options);\n        };\n      }\n\n      if ((0, _predicate.isNil)(this.props.config.cache) || this.props.config.cache <= 0) {\n        return options;\n      }\n\n      return function () {\n        var cachedOptions = _this5.state.cachedOptions;\n\n        if (cachedOptions) {\n          return Promise.resolve(cachedOptions);\n        }\n\n        if (_this5.props.config.cache > 0) {\n          return new Promise(function (resolve, reject) {\n            return options().then(function (opts) {\n              _this5.setState({\n                cachedOptions: opts\n              });\n\n              _this5.timeoutId = setTimeout(function () {\n                _this5.setState({\n                  cachedOptions: null\n                });\n              }, _this5.props.config.cache);\n              resolve(opts);\n            }).catch(function (error) {\n              reject(error);\n            });\n          });\n        }\n      };\n    }\n  }, {\n    key: \"resolveOptionName\",\n    value: function resolveOptionName(option) {\n      return option.name || option.value.toString();\n    }\n  }, {\n    key: \"onOptionClick\",\n    value: function onOptionClick(field, value, checked) {\n      var multiSelect = this.resolveMultiSelect();\n      var autoClose = this.props.autoClose; // we're closing popover only if the user can only select one item... if the\n      // user can select more, we'll leave it open so she can continue selecting\n\n      if (!multiSelect && autoClose) {\n        this.closePopover();\n        var query = checked ? this.props.query.removeSimpleFieldClauses(field) : this.props.query.removeSimpleFieldClauses(field).addSimpleFieldValue(field, value);\n        this.props.onChange(query);\n      } else {\n        if (multiSelect === 'or') {\n          var _query = checked ? this.props.query.removeOrFieldValue(field, value) : this.props.query.addOrFieldValue(field, value);\n\n          this.props.onChange(_query);\n        } else {\n          var _query2 = checked ? this.props.query.removeSimpleFieldValue(field, value) : this.props.query.addSimpleFieldValue(field, value);\n\n          this.props.onChange(_query2);\n        }\n      }\n    }\n  }, {\n    key: \"onKeyDown\",\n    value: function onKeyDown(index, event) {\n      switch (event.keyCode) {\n        case _services.keyCodes.DOWN:\n          if (index < this.selectItems.length - 1) {\n            event.preventDefault();\n            this.selectItems[index + 1].focus();\n          }\n\n          break;\n\n        case _services.keyCodes.UP:\n          if (index < 0) {\n            return; // it's coming from the search box... nothing to do... nowhere to go\n          }\n\n          if (index === 0 && this.searchInput) {\n            event.preventDefault();\n            this.searchInput.focus();\n          } else if (index > 0) {\n            event.preventDefault();\n            this.selectItems[index - 1].focus();\n          }\n\n      }\n    }\n  }, {\n    key: \"resolveMultiSelect\",\n    value: function resolveMultiSelect() {\n      var config = this.props.config;\n      return !(0, _predicate.isNil)(config.multiSelect) ? config.multiSelect : defaults.config.multiSelect;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var _this$props = this.props,\n          index = _this$props.index,\n          query = _this$props.query,\n          config = _this$props.config;\n      var multiSelect = this.resolveMultiSelect();\n      var activeTop = this.isActiveField(config.field);\n      var activeItem = this.state.options ? this.state.options.all.some(function (item) {\n        return _this6.isActiveField(item.field);\n      }) : false;\n      var active = activeTop || activeItem;\n\n      var button = _react.default.createElement(_filter_group.EuiFilterButton, {\n        iconType: \"arrowDown\",\n        iconSide: \"right\",\n        onClick: this.onButtonClick.bind(this),\n        hasActiveFilters: active,\n        grow: true\n      }, config.name);\n\n      var searchBox = this.renderSearchBox();\n      var content = this.renderContent(config.field, query, config, multiSelect);\n      var threshold = this.props.config.searchThreshold || defaults.config.searchThreshold;\n      var withTitle = this.state.options && this.state.options.all.length >= threshold;\n      return _react.default.createElement(_popover.EuiPopover, {\n        id: \"\".concat(config.type, \"_\").concat(index),\n        ownFocus: true,\n        button: button,\n        isOpen: this.state.popoverOpen,\n        closePopover: this.closePopover.bind(this),\n        panelPaddingSize: \"none\",\n        withTitle: withTitle,\n        anchorPosition: \"downCenter\",\n        panelClassName: \"euiFilterGroup__popoverPanel\"\n      }, searchBox, content);\n    }\n  }, {\n    key: \"renderSearchBox\",\n    value: function renderSearchBox() {\n      var _this7 = this;\n\n      var threshold = this.props.config.searchThreshold || defaults.config.searchThreshold;\n\n      if (this.state.options && this.state.options.all.length >= threshold) {\n        var disabled = this.state.error;\n        return _react.default.createElement(_popover_title.EuiPopoverTitle, null, _react.default.createElement(_field_search.EuiFieldSearch, {\n          inputRef: function inputRef(ref) {\n            return _this7.searchInput = ref;\n          },\n          disabled: disabled,\n          incremental: true,\n          onSearch: function onSearch(query) {\n            return _this7.filterOptions(query);\n          },\n          onKeyDown: this.onKeyDown.bind(this, -1)\n        }));\n      }\n    }\n  }, {\n    key: \"renderContent\",\n    value: function renderContent(field, query, config, multiSelect) {\n      var _this8 = this;\n\n      if (this.state.error) {\n        return this.renderError(this.state.error);\n      }\n\n      if ((0, _predicate.isNil)(this.state.options)) {\n        return this.renderLoader();\n      }\n\n      if (this.state.options.shown.length === 0) {\n        return this.renderNoOptions();\n      }\n\n      var items = this.state.options.shown.reduce(function (items, option, index) {\n        var optionField = option.field || field;\n        var clause = multiSelect === 'or' ? query.getOrFieldClause(optionField, option.value) : query.getSimpleFieldClause(optionField, option.value);\n\n        var checked = _this8.resolveChecked(clause);\n\n        var onClick = function onClick() {\n          // clicking a checked item will uncheck it and effective remove the filter (value = undefined)\n          _this8.onOptionClick(optionField, option.value, checked);\n        };\n\n        var item = _react.default.createElement(_filter_group.EuiFilterSelectItem, {\n          key: index,\n          checked: checked,\n          onClick: onClick,\n          ref: function ref(_ref) {\n            return _this8.selectItems[index] = _ref;\n          },\n          onKeyDown: _this8.onKeyDown.bind(_this8, index)\n        }, option.view ? option.view : _this8.resolveOptionName(option));\n\n        if (!checked) {\n          items.rest.push(item);\n        } else if (checked === 'on') {\n          items.on.push(item);\n        } else {\n          items.off.push(item);\n        }\n\n        return items;\n      }, {\n        on: [],\n        off: [],\n        rest: []\n      });\n      return _react.default.createElement(\"div\", {\n        className: \"euiFilterSelect__items\"\n      }, _toConsumableArray(items.on).concat(_toConsumableArray(items.off), _toConsumableArray(items.rest)));\n    }\n  }, {\n    key: \"resolveChecked\",\n    value: function resolveChecked(clause) {\n      if (clause) {\n        return _query3.Query.isMust(clause) ? 'on' : 'off';\n      }\n    }\n  }, {\n    key: \"renderLoader\",\n    value: function renderLoader() {\n      var message = this.props.config.loadingMessage || defaults.config.loadingMessage;\n      return _react.default.createElement(\"div\", {\n        className: \"euiFilterSelect__note\"\n      }, _react.default.createElement(\"div\", {\n        className: \"euiFilterSelect__noteContent\"\n      }, _react.default.createElement(_loading_chart.EuiLoadingChart, {\n        size: \"m\"\n      }), _react.default.createElement(_spacer.EuiSpacer, {\n        size: \"xs\"\n      }), _react.default.createElement(\"p\", null, message)));\n    }\n  }, {\n    key: \"renderError\",\n    value: function renderError(message) {\n      return _react.default.createElement(\"div\", {\n        className: \"euiFilterSelect__note\"\n      }, _react.default.createElement(\"div\", {\n        className: \"euiFilterSelect__noteContent\"\n      }, _react.default.createElement(_icon.EuiIcon, {\n        size: \"m\",\n        type: \"faceSad\",\n        color: \"danger\"\n      }), _react.default.createElement(_spacer.EuiSpacer, {\n        size: \"xs\"\n      }), _react.default.createElement(\"p\", null, message)));\n    }\n  }, {\n    key: \"renderNoOptions\",\n    value: function renderNoOptions() {\n      var message = this.props.config.noOptionsMessage || defaults.config.noOptionsMessage;\n      return _react.default.createElement(\"div\", {\n        className: \"euiFilterSelect__note\"\n      }, _react.default.createElement(\"div\", {\n        className: \"euiFilterSelect__noteContent\"\n      }, _react.default.createElement(_icon.EuiIcon, {\n        type: \"minusInCircle\"\n      }), _react.default.createElement(_spacer.EuiSpacer, {\n        size: \"xs\"\n      }), _react.default.createElement(\"p\", null, message)));\n    }\n  }, {\n    key: \"isActiveField\",\n    value: function isActiveField(field) {\n      if (typeof field !== 'string') {\n        return false;\n      }\n\n      var query = this.props.query;\n      var multiSelect = this.resolveMultiSelect();\n\n      if (multiSelect === 'or') {\n        return query.hasOrFieldClause(field);\n      }\n\n      return query.hasSimpleFieldClause(field);\n    }\n  }]);\n\n  return FieldValueSelectionFilter;\n}(_react.Component);\n\nexports.FieldValueSelectionFilter = FieldValueSelectionFilter;\n\n_defineProperty(FieldValueSelectionFilter, \"propTypes\", FieldValueSelectionFilterPropTypes);\n\n_defineProperty(FieldValueSelectionFilter, \"defaultProps\", {\n  autoClose: true\n});\n\nFieldValueSelectionFilter.__docgenInfo = {\n  \"description\": \"\",\n  \"methods\": [{\n    \"name\": \"closePopover\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"onButtonClick\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"loadOptions\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"filterOptions\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"q\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"getOptionFilter\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"resolveOptionsLoader\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"resolveOptionName\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"option\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"onOptionClick\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"field\",\n      \"type\": null\n    }, {\n      \"name\": \"value\",\n      \"type\": null\n    }, {\n      \"name\": \"checked\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"onKeyDown\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"index\",\n      \"type\": null\n    }, {\n      \"name\": \"event\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"resolveMultiSelect\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"renderSearchBox\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"renderContent\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"field\",\n      \"type\": null\n    }, {\n      \"name\": \"query\",\n      \"type\": null\n    }, {\n      \"name\": \"config\",\n      \"type\": null\n    }, {\n      \"name\": \"multiSelect\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"resolveChecked\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"clause\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"renderLoader\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"renderError\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"message\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"renderNoOptions\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"isActiveField\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"field\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }],\n  \"displayName\": \"FieldValueSelectionFilter\",\n  \"props\": {\n    \"autoClose\": {\n      \"defaultValue\": {\n        \"value\": \"true\",\n        \"computed\": false\n      },\n      \"required\": false\n    },\n    \"index\": {\n      \"type\": {\n        \"name\": \"number\"\n      },\n      \"required\": true,\n      \"description\": \"\"\n    },\n    \"config\": {\n      \"type\": {\n        \"name\": \"custom\",\n        \"raw\": \"FieldValueSelectionFilterConfigType.isRequired\"\n      },\n      \"required\": false,\n      \"description\": \"\"\n    },\n    \"query\": {\n      \"type\": {\n        \"name\": \"any\"\n      },\n      \"required\": true,\n      \"description\": \"\"\n    },\n    \"onChange\": {\n      \"type\": {\n        \"name\": \"func\"\n      },\n      \"required\": true,\n      \"description\": \"\"\n    }\n  }\n};",{"version":3,"sources":["/Users/chanderprall/projects/eui/src/components/search_bar/filters/field_value_selection_filter.js"],"names":["FieldValueOptionType","PropTypes","shape","field","string","value","any","isRequired","name","view","node","FieldValueOptionsType","oneOfType","func","arrayOf","FieldValueSelectionFilterConfigType","type","EuiPropTypes","is","autoClose","boolean","options","filterWith","oneOf","cache","number","multiSelect","bool","loadingMessage","noOptionsMessage","searchThreshold","available","FieldValueSelectionFilterPropTypes","index","config","query","onChange","defaults","FieldValueSelectionFilter","props","preloadedOptions","all","shown","selectItems","state","popoverOpen","error","setState","prevState","window","requestAnimationFrame","loadOptions","loader","resolveOptionsLoader","then","catch","q","predicate","getOptionFilter","filter","option","i","resolveOptionName","toLowerCase","includes","startsWith","Promise","resolve","cachedOptions","reject","opts","timeoutId","setTimeout","toString","checked","resolveMultiSelect","closePopover","removeSimpleFieldClauses","addSimpleFieldValue","removeOrFieldValue","addOrFieldValue","removeSimpleFieldValue","event","keyCode","keyCodes","DOWN","length","preventDefault","focus","UP","searchInput","activeTop","isActiveField","activeItem","some","item","active","button","onButtonClick","bind","searchBox","renderSearchBox","content","renderContent","threshold","withTitle","disabled","ref","filterOptions","onKeyDown","renderError","renderLoader","renderNoOptions","items","reduce","optionField","clause","getOrFieldClause","getSimpleFieldClause","resolveChecked","onClick","onOptionClick","rest","push","on","off","Query","isMust","message","hasOrFieldClause","hasSimpleFieldClause","Component"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { isArray, isNil } from '../../../services/predicate';\nimport { keyCodes } from '../../../services';\nimport { EuiPropTypes } from '../../../utils/prop_types';\nimport { EuiPopover } from '../../popover/popover';\nimport { EuiPopoverTitle } from '../../popover/popover_title';\nimport { EuiFieldSearch } from '../../form/field_search/field_search';\nimport { EuiFilterSelectItem, EuiFilterButton } from '../../filter_group';\nimport { EuiLoadingChart } from '../../loading/loading_chart';\nimport { EuiSpacer } from '../../spacer/spacer';\nimport { EuiIcon } from '../../icon/icon';\nimport { Query } from '../query';\n\nconst FieldValueOptionType = PropTypes.shape({\n  field: PropTypes.string,\n  value: PropTypes.any.isRequired,\n  name: PropTypes.string,\n  view: PropTypes.node,\n});\n\nconst FieldValueOptionsType = PropTypes.oneOfType([\n  PropTypes.func, // (query) => Promise<FieldValueOptionType[]>\n  PropTypes.arrayOf(FieldValueOptionType),\n]);\n\nexport const FieldValueSelectionFilterConfigType = PropTypes.shape({\n  type: EuiPropTypes.is('field_value_selection').isRequired,\n  field: PropTypes.string,\n  autoClose: PropTypes.boolean,\n  name: PropTypes.string.isRequired,\n  options: FieldValueOptionsType.isRequired,\n  filterWith: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.oneOf(['prefix', 'includes']),\n  ]),\n  cache: PropTypes.number,\n  multiSelect: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.oneOf(['and', 'or']),\n  ]),\n  loadingMessage: PropTypes.string,\n  noOptionsMessage: PropTypes.string,\n  searchThreshold: PropTypes.number,\n  available: PropTypes.func, // () => boolean\n});\n\nconst FieldValueSelectionFilterPropTypes = {\n  index: PropTypes.number.isRequired,\n  config: FieldValueSelectionFilterConfigType.isRequired,\n  query: PropTypes.any.isRequired,\n  onChange: PropTypes.func.isRequired, // (value) => void\n};\n\nconst defaults = {\n  config: {\n    multiSelect: true,\n    filterWith: 'prefix',\n    loadingMessage: 'Loading...',\n    noOptionsMessage: 'No options found',\n    searchThreshold: 10,\n  },\n};\n\nexport class FieldValueSelectionFilter extends Component {\n  static propTypes = FieldValueSelectionFilterPropTypes;\n\n  static defaultProps = {\n    autoClose: true,\n  };\n\n  constructor(props) {\n    super(props);\n\n    const { options } = props.config;\n\n    const preloadedOptions = isArray(options)\n      ? {\n          all: options,\n          shown: options,\n        }\n      : null;\n\n    this.selectItems = [];\n    this.state = {\n      popoverOpen: false,\n      error: null,\n      options: preloadedOptions,\n    };\n  }\n\n  closePopover() {\n    this.setState({ popoverOpen: false });\n  }\n\n  onButtonClick() {\n    this.setState(prevState => {\n      if (!prevState.popoverOpen) {\n        // loading options updates the state, so we'll do that in the animation frame\n        window.requestAnimationFrame(() => {\n          this.loadOptions();\n        });\n      }\n      return {\n        options: null,\n        error: null,\n        popoverOpen: !prevState.popoverOpen,\n      };\n    });\n  }\n\n  loadOptions() {\n    const loader = this.resolveOptionsLoader();\n    this.setState({ options: null, error: null });\n    loader()\n      .then(options => {\n        this.setState({\n          error: null,\n          options: {\n            all: options,\n            shown: options,\n          },\n        });\n      })\n      .catch(() => {\n        this.setState({ options: null, error: 'Could not load options' });\n      });\n  }\n\n  filterOptions(q = '') {\n    this.setState(prevState => {\n      if (isNil(prevState.options)) {\n        return {};\n      }\n\n      const predicate = this.getOptionFilter();\n\n      return {\n        options: {\n          ...prevState.options,\n          shown: prevState.options.all.filter((option, i, options) => {\n            const name = this.resolveOptionName(option).toLowerCase();\n            const query = q.toLowerCase();\n            return predicate(name, query, options);\n          }),\n        },\n      };\n    });\n  }\n\n  getOptionFilter() {\n    const filterWith =\n      this.props.config.filterWith || defaults.config.filterWith;\n\n    if (typeof filterWith === 'function') {\n      return filterWith;\n    }\n\n    if (filterWith === 'includes') {\n      return (name, query) => name.includes(query);\n    }\n\n    return (name, query) => name.startsWith(query);\n  }\n\n  resolveOptionsLoader() {\n    const options = this.props.config.options;\n    if (isArray(options)) {\n      return () => Promise.resolve(options);\n    }\n    if (isNil(this.props.config.cache) || this.props.config.cache <= 0) {\n      return options;\n    }\n    return () => {\n      const cachedOptions = this.state.cachedOptions;\n      if (cachedOptions) {\n        return Promise.resolve(cachedOptions);\n      }\n      if (this.props.config.cache > 0) {\n        return new Promise((resolve, reject) => {\n          return options()\n            .then(opts => {\n              this.setState({ cachedOptions: opts });\n              this.timeoutId = setTimeout(() => {\n                this.setState({ cachedOptions: null });\n              }, this.props.config.cache);\n              resolve(opts);\n            })\n            .catch(error => {\n              reject(error);\n            });\n        });\n      }\n    };\n  }\n\n  resolveOptionName(option) {\n    return option.name || option.value.toString();\n  }\n\n  onOptionClick(field, value, checked) {\n    const multiSelect = this.resolveMultiSelect();\n    const { autoClose } = this.props;\n\n    // we're closing popover only if the user can only select one item... if the\n    // user can select more, we'll leave it open so she can continue selecting\n\n    if (!multiSelect && autoClose) {\n      this.closePopover();\n      const query = checked\n        ? this.props.query.removeSimpleFieldClauses(field)\n        : this.props.query\n            .removeSimpleFieldClauses(field)\n            .addSimpleFieldValue(field, value);\n\n      this.props.onChange(query);\n    } else {\n      if (multiSelect === 'or') {\n        const query = checked\n          ? this.props.query.removeOrFieldValue(field, value)\n          : this.props.query.addOrFieldValue(field, value);\n\n        this.props.onChange(query);\n      } else {\n        const query = checked\n          ? this.props.query.removeSimpleFieldValue(field, value)\n          : this.props.query.addSimpleFieldValue(field, value);\n\n        this.props.onChange(query);\n      }\n    }\n  }\n\n  onKeyDown(index, event) {\n    switch (event.keyCode) {\n      case keyCodes.DOWN:\n        if (index < this.selectItems.length - 1) {\n          event.preventDefault();\n          this.selectItems[index + 1].focus();\n        }\n        break;\n\n      case keyCodes.UP:\n        if (index < 0) {\n          return; // it's coming from the search box... nothing to do... nowhere to go\n        }\n        if (index === 0 && this.searchInput) {\n          event.preventDefault();\n          this.searchInput.focus();\n        } else if (index > 0) {\n          event.preventDefault();\n          this.selectItems[index - 1].focus();\n        }\n    }\n  }\n\n  resolveMultiSelect() {\n    const { config } = this.props;\n    return !isNil(config.multiSelect)\n      ? config.multiSelect\n      : defaults.config.multiSelect;\n  }\n\n  render() {\n    const { index, query, config } = this.props;\n    const multiSelect = this.resolveMultiSelect();\n\n    const activeTop = this.isActiveField(config.field);\n    const activeItem = this.state.options\n      ? this.state.options.all.some(item => this.isActiveField(item.field))\n      : false;\n\n    const active = activeTop || activeItem;\n\n    const button = (\n      <EuiFilterButton\n        iconType=\"arrowDown\"\n        iconSide=\"right\"\n        onClick={this.onButtonClick.bind(this)}\n        hasActiveFilters={active}\n        grow>\n        {config.name}\n      </EuiFilterButton>\n    );\n\n    const searchBox = this.renderSearchBox();\n    const content = this.renderContent(\n      config.field,\n      query,\n      config,\n      multiSelect\n    );\n    const threshold =\n      this.props.config.searchThreshold || defaults.config.searchThreshold;\n    const withTitle =\n      this.state.options && this.state.options.all.length >= threshold;\n\n    return (\n      <EuiPopover\n        id={`${config.type}_${index}`}\n        ownFocus\n        button={button}\n        isOpen={this.state.popoverOpen}\n        closePopover={this.closePopover.bind(this)}\n        panelPaddingSize=\"none\"\n        withTitle={withTitle}\n        anchorPosition=\"downCenter\"\n        panelClassName=\"euiFilterGroup__popoverPanel\">\n        {searchBox}\n        {content}\n      </EuiPopover>\n    );\n  }\n\n  renderSearchBox() {\n    const threshold =\n      this.props.config.searchThreshold || defaults.config.searchThreshold;\n    if (this.state.options && this.state.options.all.length >= threshold) {\n      const disabled = this.state.error;\n      return (\n        <EuiPopoverTitle>\n          <EuiFieldSearch\n            inputRef={ref => (this.searchInput = ref)}\n            disabled={disabled}\n            incremental={true}\n            onSearch={query => this.filterOptions(query)}\n            onKeyDown={this.onKeyDown.bind(this, -1)}\n          />\n        </EuiPopoverTitle>\n      );\n    }\n  }\n\n  renderContent(field, query, config, multiSelect) {\n    if (this.state.error) {\n      return this.renderError(this.state.error);\n    }\n    if (isNil(this.state.options)) {\n      return this.renderLoader();\n    }\n    if (this.state.options.shown.length === 0) {\n      return this.renderNoOptions();\n    }\n    const items = this.state.options.shown.reduce(\n      (items, option, index) => {\n        const optionField = option.field || field;\n\n        const clause =\n          multiSelect === 'or'\n            ? query.getOrFieldClause(optionField, option.value)\n            : query.getSimpleFieldClause(optionField, option.value);\n\n        const checked = this.resolveChecked(clause);\n        const onClick = () => {\n          // clicking a checked item will uncheck it and effective remove the filter (value = undefined)\n          this.onOptionClick(optionField, option.value, checked);\n        };\n\n        const item = (\n          <EuiFilterSelectItem\n            key={index}\n            checked={checked}\n            onClick={onClick}\n            ref={ref => (this.selectItems[index] = ref)}\n            onKeyDown={this.onKeyDown.bind(this, index)}>\n            {option.view ? option.view : this.resolveOptionName(option)}\n          </EuiFilterSelectItem>\n        );\n        if (!checked) {\n          items.rest.push(item);\n        } else if (checked === 'on') {\n          items.on.push(item);\n        } else {\n          items.off.push(item);\n        }\n        return items;\n      },\n      { on: [], off: [], rest: [] }\n    );\n    return (\n      <div className=\"euiFilterSelect__items\">\n        {[...items.on, ...items.off, ...items.rest]}\n      </div>\n    );\n  }\n\n  resolveChecked(clause) {\n    if (clause) {\n      return Query.isMust(clause) ? 'on' : 'off';\n    }\n  }\n\n  renderLoader() {\n    const message =\n      this.props.config.loadingMessage || defaults.config.loadingMessage;\n    return (\n      <div className=\"euiFilterSelect__note\">\n        <div className=\"euiFilterSelect__noteContent\">\n          <EuiLoadingChart size=\"m\" />\n          <EuiSpacer size=\"xs\" />\n          <p>{message}</p>\n        </div>\n      </div>\n    );\n  }\n\n  renderError(message) {\n    return (\n      <div className=\"euiFilterSelect__note\">\n        <div className=\"euiFilterSelect__noteContent\">\n          <EuiIcon size=\"m\" type=\"faceSad\" color=\"danger\" />\n          <EuiSpacer size=\"xs\" />\n          <p>{message}</p>\n        </div>\n      </div>\n    );\n  }\n\n  renderNoOptions() {\n    const message =\n      this.props.config.noOptionsMessage || defaults.config.noOptionsMessage;\n    return (\n      <div className=\"euiFilterSelect__note\">\n        <div className=\"euiFilterSelect__noteContent\">\n          <EuiIcon type=\"minusInCircle\" />\n          <EuiSpacer size=\"xs\" />\n          <p>{message}</p>\n        </div>\n      </div>\n    );\n  }\n\n  isActiveField(field) {\n    if (typeof field !== 'string') {\n      return false;\n    }\n\n    const { query } = this.props;\n    const multiSelect = this.resolveMultiSelect();\n\n    if (multiSelect === 'or') {\n      return query.hasOrFieldClause(field);\n    }\n\n    return query.hasSimpleFieldClause(field);\n  }\n}\n"]}]}