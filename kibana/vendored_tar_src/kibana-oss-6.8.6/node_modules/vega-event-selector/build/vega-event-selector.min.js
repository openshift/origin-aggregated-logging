!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.vega=e.vega||{})}(this,function(e){"use strict";function t(e){return c.hasOwnProperty(e)}function r(e,t,r,n,i){for(var o,s=0,f=e.length;t<f;++t){if(o=e[t],!s&&o===r)return t;i&&i.indexOf(o)>=0?--s:n&&n.indexOf(o)>=0&&++s}return t}function n(e){for(var t=[],n=0,i=e.length,o=0;o<i;)o=r(e,o,w,a+p,h+m),t.push(e.substring(n,o).trim()),n=++o;if(0===t.length)throw"Empty event selector: "+e;return t}function i(e){return"["===e[0]?o(e):s(e)}function o(e){var t,o,s=e.length,f=1;if((f=r(e,f,h,a,h))===s)throw"Empty between selector: "+e;if(2!==(t=n(e.substring(1,f))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(f+1).trim())[0]!==d)throw"Expected '>' after between selector: "+e;return t=t.map(i),(o=i(e.slice(1).trim())).between?{between:t,stream:o}:(o.between=t,o)}function s(e){var n,i,o={source:u},s=[],c=[0,0],l=0,w=0,d=e.length,y=0;if(e[d-1]===m){if(!((y=e.lastIndexOf(p))>=0))throw"Unmatched right brace: "+e;try{c=f(e.substring(y+1,d-1))}catch(t){throw"Invalid throttle specification: "+e}d=(e=e.slice(0,y).trim()).length,y=0}if(!d)throw e;if(e[0]===b&&(l=++y),(n=r(e,y,g))<d&&(s.push(e.substring(w,n).trim()),w=y=++n),(y=r(e,y,a))===d)s.push(e.substring(w,d).trim());else if(s.push(e.substring(w,y).trim()),i=[],(w=++y)===d)throw"Unmatched left bracket: "+e;for(;y<d;){if((y=r(e,y,h))===d)throw"Unmatched left bracket: "+e;if(i.push(e.substring(w,y).trim()),y<d-1&&e[++y]!==a)throw"Expected left bracket: "+e;w=++y}if(!(d=s.length)||v.test(s[d-1]))throw"Invalid event selector: "+e;return d>1?(o.type=s[1],l?o.markname=s[0].slice(1):t(s[0])?o.marktype=s[0]:o.source=s[0]):o.type=s[0],"!"===o.type.slice(-1)&&(o.consume=!0,o.type=o.type.slice(0,-1)),null!=i&&(o.filter=i),c[0]&&(o.throttle=c[0]),c[1]&&(o.debounce=c[1]),o}function f(e){var t=e.split(w);if(!e.length||t.length>2)throw e;return t.map(function(t){var r=+t;if(r!==r)throw e;return r})}var u,c,l="view",a="[",h="]",p="{",m="}",g=":",w=",",b="@",d=">",v=/[[\]{}]/,y={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};e.selector=function(e,t,r){return u=t||l,c=r||y,n(e.trim()).map(i)},Object.defineProperty(e,"__esModule",{value:!0})});