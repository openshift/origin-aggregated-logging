// https://d3js.org/d3-contour/ Version 1.2.0. Copyright 2018 Mike Bostock.
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],r):r(t.d3=t.d3||{},t.d3)}(this,function(t,r){"use strict";function n(t,r,n){for(var e=t.width,i=t.height,a=1+(n<<1),o=0;o<i;++o)for(var h=0,f=0;h<e+n;++h)h<e&&(f+=t.data[h+o*e]),h>=n&&(h>=a&&(f-=t.data[h-a+o*e]),r.data[h-n+o*e]=f/Math.min(h+1,e-1+a-h,a))}function e(t,r,n){for(var e=t.width,i=t.height,a=1+(n<<1),o=0;o<e;++o)for(var h=0,f=0;h<i+n;++h)h<i&&(f+=t.data[o+h*e]),h>=n&&(h>=a&&(f-=t.data[o+(h-a)*e]),r.data[o+(h-n)*e]=f/Math.min(h+1,i-1+a-h,a))}var i=Array.prototype.slice,a=function(t,r){return t-r},o=function(t){for(var r=0,n=t.length,e=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++r<n;)e+=t[r-1][1]*t[r][0]-t[r-1][0]*t[r][1];return e},h=function(t){return function(){return t}},f=function(t,r){for(var n,e=-1,i=r.length;++e<i;)if(n=function(t,r){for(var n=r[0],e=r[1],i=-1,a=0,o=t.length,h=o-1;a<o;h=a++){var f=t[a],u=f[0],c=f[1],d=t[h],l=d[0],s=d[1];if(function(t,r,n){var e;return function(t,r,n){return(r[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(r[1]-t[1])}(t,r,n)&&function(t,r,n){return t<=r&&r<=n||n<=r&&r<=t}(t[e=+(t[0]===r[0])],n[e],r[e])}(f,d,r))return 0;c>e!=s>e&&n<(l-u)*(e-c)/(s-c)+u&&(i=-i)}return i}(t,r[e]))return n;return 0},u=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]],c=function(){function t(t){var e=s(t);if(Array.isArray(e))e=e.slice().sort(a);else{var i=r.extent(t),o=i[0],h=i[1];e=r.tickStep(o,h,e),e=r.range(Math.floor(o/e)*e,Math.floor(h/e)*e,e)}return e.map(function(r){return n(t,r)})}function n(t,r){var n=[],i=[];return function(t,r,n){function i(t){var r,i,h=[t[0][0]+a,t[0][1]+o],f=[t[1][0]+a,t[1][1]+o],u=e(h),c=e(f);(r=v[u])?(i=g[c])?(delete v[r.end],delete g[i.start],r===i?(r.ring.push(f),n(r.ring)):g[r.start]=v[i.end]={start:r.start,end:i.end,ring:r.ring.concat(i.ring)}):(delete v[r.end],r.ring.push(f),v[r.end=c]=r):(r=g[c])?(i=v[u])?(delete g[r.start],delete v[i.end],r===i?(r.ring.push(f),n(r.ring)):g[i.start]=v[r.end]={start:i.start,end:r.end,ring:i.ring.concat(r.ring)}):(delete g[r.start],r.ring.unshift(h),g[r.start=u]=r):g[u]=v[c]={start:u,end:c,ring:[h,f]}}var a,o,h,f,c,s,g=new Array,v=new Array;a=o=-1,f=t[0]>=r,u[f<<1].forEach(i);for(;++a<d-1;)h=f,f=t[a+1]>=r,u[h|f<<1].forEach(i);u[f<<0].forEach(i);for(;++o<l-1;){for(a=-1,f=t[o*d+d]>=r,c=t[o*d]>=r,u[f<<1|c<<2].forEach(i);++a<d-1;)h=f,f=t[o*d+d+a+1]>=r,s=c,c=t[o*d+a+1]>=r,u[h|f<<1|c<<2|s<<3].forEach(i);u[f|c<<3].forEach(i)}a=-1,c=t[o*d]>=r,u[c<<2].forEach(i);for(;++a<d-1;)s=c,c=t[o*d+a+1]>=r,u[c<<2|s<<3].forEach(i);u[c<<3].forEach(i)}(t,r,function(e){g(e,t,r),o(e)>0?n.push([e]):i.push(e)}),i.forEach(function(t){for(var r,e=0,i=n.length;e<i;++e)if(-1!==f((r=n[e])[0],t))return void r.push(t)}),{type:"MultiPolygon",value:r,coordinates:n}}function e(t){return 2*t[0]+t[1]*(d+1)*4}function c(t,r,n){t.forEach(function(t){var e,i=t[0],a=t[1],o=0|i,h=0|a,f=r[h*d+o];i>0&&i<d&&o===i&&(e=r[h*d+o-1],t[0]=i+(n-e)/(f-e)-.5),a>0&&a<l&&h===a&&(e=r[(h-1)*d+o],t[1]=a+(n-e)/(f-e)-.5)})}var d=1,l=1,s=r.thresholdSturges,g=c;return t.contour=n,t.size=function(r){if(!arguments.length)return[d,l];var n=Math.ceil(r[0]),e=Math.ceil(r[1]);if(!(n>0&&e>0))throw new Error("invalid size");return d=n,l=e,t},t.thresholds=function(r){return arguments.length?(s="function"==typeof r?r:h(Array.isArray(r)?i.call(r):r),t):s},t.smooth=function(r){return arguments.length?(g=r?c:function(){},t):g===c},t};t.contours=c,t.contourDensity=function(){function t(t){var i=new Float32Array(v*w),a=new Float32Array(v*w);t.forEach(function(t,r,n){var e=o(t,r,n)+g>>s,a=f(t,r,n)+g>>s;e>=0&&e<v&&a>=0&&a<w&&++i[e+a*v]}),n({width:v,height:w,data:i},{width:v,height:w,data:a},l>>s),e({width:v,height:w,data:a},{width:v,height:w,data:i},l>>s),n({width:v,height:w,data:i},{width:v,height:w,data:a},l>>s),e({width:v,height:w,data:a},{width:v,height:w,data:i},l>>s),n({width:v,height:w,data:i},{width:v,height:w,data:a},l>>s),e({width:v,height:w,data:a},{width:v,height:w,data:i},l>>s);var h=y(i);if(!Array.isArray(h)){var u=r.max(i);h=r.tickStep(0,u,h),(h=r.range(0,Math.floor(u/h)*h,h)).shift()}return c().thresholds(h).size([v,w])(i).map(function(t){return t.value*=Math.pow(2,-2*s),t.coordinates.forEach(function(t){t.forEach(function(t){t.forEach(function(t){t[0]=t[0]*Math.pow(2,s)-g,t[1]=t[1]*Math.pow(2,s)-g})})}),t})}function a(){return g=3*l,v=u+2*g>>s,w=d+2*g>>s,t}var o=function(t){return t[0]},f=function(t){return t[1]},u=960,d=500,l=20,s=2,g=3*l,v=u+2*g>>s,w=d+2*g>>s,y=h(20);return t.x=function(r){return arguments.length?(o="function"==typeof r?r:h(+r),t):o},t.y=function(r){return arguments.length?(f="function"==typeof r?r:h(+r),t):f},t.size=function(t){if(!arguments.length)return[u,d];var r=Math.ceil(t[0]),n=Math.ceil(t[1]);if(!(r>=0||r>=0))throw new Error("invalid size");return u=r,d=n,a()},t.cellSize=function(t){if(!arguments.length)return 1<<s;if(!((t=+t)>=1))throw new Error("invalid cell size");return s=Math.floor(Math.log(t)/Math.LN2),a()},t.thresholds=function(r){return arguments.length?(y="function"==typeof r?r:h(Array.isArray(r)?i.call(r):r),t):y},t.bandwidth=function(t){if(!arguments.length)return Math.sqrt(l*(l+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return l=Math.round((Math.sqrt(4*t*t+1)-1)/2),a()},t},Object.defineProperty(t,"__esModule",{value:!0})});