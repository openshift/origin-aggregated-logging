<filter kubernetes.var.log.containers**>
  @type record_transformer
  enable_ruby
  <record>
    hostname ${(record['kubernetes']['host'] rescue nil) || File.open('/etc/docker-hostname') { |f| f.readline }.rstrip}
    message ${(message rescue nil) || log}
    pipeline_metadata {"collector":{"ipaddr4":"${ENV['IPADDR4']}","ipaddr6":"${ENV['IPADDR6']}","inputname":"fluent-plugin-in_tail","name":"fluentd openshift","received_at":"${record['time'].to_s}","version":"${ENV['FLUENTD_VERSION'] + ' ' + ENV['DATA_VERSION']}"}}
    level ${record['stream'] == 'stdout' ? 'info' : 'err'}
    time ${time.utc.to_datetime.rfc3339(6)}
  </record>
  remove_keys log,stream
</filter>
