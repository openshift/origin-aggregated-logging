<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Alan Conway">
<title>Cluster Logging Architecture</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Cluster Logging Architecture</h1>
<div class="details">
<span id="author" class="author">Alan Conway</span><br>
<span id="email" class="email"><a href="mailto:aconway@redhat.com">aconway@redhat.com</a></span><br>
<span id="revdate">updated 09:27:08 -0500</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#terms-and-definitions">Terms and definitions</a></li>
</ul>
</li>
<li><a href="#architecture-summary">Architecture Summary</a>
<ul class="sectlevel2">
<li><a href="#logical-components">Logical Components</a></li>
<li><a href="#implementation-components">Implementation Components</a></li>
<li><a href="#operators-and-custom-resources">Operators and Custom Resources</a></li>
<li><a href="#components-on-each-node">Components on each Node</a></li>
<li><a href="#log-formats">Log Formats</a></li>
</ul>
</li>
<li><a href="#work-in-progress">Work in progress</a>
<ul class="sectlevel2">
<li><a href="#proposals-under-reviewdevelopment">Proposals under review/development</a></li>
<li><a href="#flow-control">Flow Control</a></li>
<li><a href="#error-reporting">Error Reporting</a></li>
<li><a href="#review-data-model">Review Data Model.</a></li>
<li><a href="#multi-line-support">Multi-line support</a></li>
<li><a href="#syslog-meta-data">Syslog meta-data</a></li>
<li><a href="#loki-as-store">Loki as store</a></li>
<li><a href="#observabilitytelemetry">Observability/Telemetry</a></li>
</ul>
</li>
<li><a href="#updating-this-page">Updating this page</a></li>
<li><a href="#resources">Resources</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goals of this page are to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Be brief and up-to-date; stored with the code.</p>
</li>
<li>
<p>Provide overview and snapshot of current status and coming changes.</p>
</li>
<li>
<p>Provide links to navigate to other project <a href="#resources">Resources</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This page does <em>not</em> replace or duplicate information in <a href="https://issues.redhat.com/projects/LOG/issues/LOG-96?filter=allopenissues">JIRA</a>, <a href="https://bugzilla.redhat.com/buglist.cgi?cmdtype=runnamed&amp;list_id=11292768&amp;namedcmd=All%20Cluster%20Logging%20Bugs">Bugzilla</a>, <a href="https://github.com/openshift/enhancements/tree/master/enhancements/cluster-logging">enhancement proposals</a>, or the <a href="https://github.com/openshift/enhancements/blob/master/guidelines/README.md">enhancement proposal process</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="terms-and-definitions">Terms and definitions</h3>
<div class="paragraph">
<p>This page uses the following specific terms and definitions:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Log
</td>
<td class="hdlist2">
<p>A stream of text containing a sequence of entries.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Entry
</td>
<td class="hdlist2">
<p>A single log entry, usually (but not always) a single line of text.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Meta-data
</td>
<td class="hdlist2">
<p>Data describing a log entry, for example timestamp, origin, schema, labels, etc.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Record
</td>
<td class="hdlist2">
<p>A key-value map containing an <em>entry</em> and associated <em>meta-data</em>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Schema
</td>
<td class="hdlist2">
<p>Definition of key names and value types in a record or structured entry.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Data Model
</td>
<td class="hdlist2">
<p>The <a href="schema]">data_model</a> for the forwarder&#8217;s own <strong>record</strong>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Consumer
</td>
<td class="hdlist2">
<p>A destination for logs, such as a store or other log processor.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Encoding
</td>
<td class="hdlist2">
<p>The encoding used to send records to a consumer.
For example a JSON object or rsyslog message.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are some important types of log:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Structured Logs
</td>
<td class="hdlist2">
<p>Each log entry consists of key-value pairs. Usually entries are JSON objects, but other formats are possible in future.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Container Logs
</td>
<td class="hdlist2">
<p>The <code>stdout</code> and <code>stderr</code> of containers, written to disk by CRI-O</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Node Logs
</td>
<td class="hdlist2">
<p>Logs written by the nodes native log system, normally <code>journald</code> or <code>syslog</code></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are three logging <em>categories</em>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Application
</td>
<td class="hdlist2">
<p>Container logs from non-infrastructure containers.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Infrastructure
</td>
<td class="hdlist2">
<p>Node logs and container logs from <code>kube-<strong></code> and <code>openshift-</strong></code> namespaces.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Audit
</td>
<td class="hdlist2">
<p>Node logs from <code>/var/log/audit</code>, security sensitive.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture-summary">Architecture Summary</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="logical-components">Logical Components</h3>
<div class="paragraph">
<p>The logical <em>core</em> components are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Collector
</td>
<td class="hdlist2">
<p>Reads container log entries and meta-data from each node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Normalizer
</td>
<td class="hdlist2">
<p>Re-formats log records suitable for forwarding.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Forwarder
</td>
<td class="hdlist2">
<p>Forwards log data to configured outputs.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The core components are responsible for getting logs from containers to consumers.</p>
</div>
<div class="paragraph">
<p>Some consumers are targets outside of this architecture.
For example the forwarder can send to rsyslog servers, but configuration and operation of such servers is out of scope for this architecture.</p>
</div>
<div class="paragraph">
<p>The <em>explore</em> components are consumers that are part of this architecture.
Logical explore components are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Store
</td>
<td class="hdlist2">
<p>Store log data for analysis.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Exploration
</td>
<td class="hdlist2">
<p>UI tools (GUI and command line) to search, query and view stored logs</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="implementation-components">Implementation Components</h3>
<div class="paragraph">
<p>The current version is implemented with these components:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Fluentd
</td>
<td class="hdlist2">
<p>acts as <em>collector</em>, <em>normalizer</em> and <em>forwarder</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Elasticsearch
</td>
<td class="hdlist2">
<p><em>store</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Kibana
</td>
<td class="hdlist2">
<p><em>exploration</em></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In future versions we expect to use:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
FluentBit
</td>
<td class="hdlist2">
<p><em>collector</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
FluentBit, Fluentd
</td>
<td class="hdlist2">
<p>in some combination as <em>normalizer</em> and <em>forwarder</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Loki
</td>
<td class="hdlist2">
<p><em>store</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Grafana, Openshift Console Plug-ins
</td>
<td class="hdlist2">
<p><em>exploration</em></p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="operators-and-custom-resources">Operators and Custom Resources</h3>
<div class="imageblock">
<div class="content">
<img src="legend.svg" alt="legend">
</div>
<div class="title">Figure 1. Key to diagrams</div>
</div>
<div class="imageblock">
<div class="content">
<img src="overview.svg" alt="overview">
</div>
<div class="title">Figure 2. Operators and Custom Resources</div>
</div>
<div class="paragraph">
<p>The <strong>cluster logging operator (CLO)</strong> implements the following custom resources:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ClusterLogging (CL)</dt>
<dd>
<p>Deploys the <em>collector</em> and <em>forwarder</em> which currently are both implemented by a <em>daemonset</em> running <em>Fluentd</em> on each node.</p>
</dd>
<dt class="hdlist1">ClusterLogForwarder (CLF)</dt>
<dd>
<p>Generate Fluentd configuration to forward logs per user configuration.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <strong>elasticsearch logging operator (ELO)</strong> implements the following custom resources:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Elasticsearch</dt>
<dd>
<p>Configure and deploy an Elasticsearch instance as the default log store.</p>
</dd>
<dt class="hdlist1">Kibana</dt>
<dd>
<p>Configure and deploy Kibana instance to search, query and view logs.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="components-on-each-node">Components on each Node</h3>
<div class="imageblock">
<div class="content">
<img src="node.svg" alt="node">
</div>
<div class="title">Figure 3. Collection and forwarding</div>
</div>
<div class="paragraph">
<p>The <em>container run-time interface</em> (CRI-O) on each node writes container logs to files.
The file names include the container&#8217;s UID, namespace, name and other data.
We also collect per-node logs from the Linux <em>journald</em>.</p>
</div>
<div class="paragraph">
<p>The CLO deploys a Fluentd daemon on each node which acts both as a <em>collector</em> (reading log files) and as a <em>forwarder</em> (sending log data to configured outputs)</p>
</div>
</div>
<div class="sect2">
<h3 id="log-formats">Log Formats</h3>
<div class="paragraph">
<p>Kubernetes does not enforce a uniform format for logs.
Anything that a containerized process writes to <code>stdout</code> or <code>stderr</code> is considered a log.
This allows existing applications to run on the cluster, but means we can&#8217;t rely on a predictable log format in general.</p>
</div>
<div class="paragraph">
<p>Traditional log formats write entries as ordered fields.
The order, field separator, format and meaning of fields varies.</p>
</div>
<div class="paragraph">
<p>Structured logs write log entries as JSON objects on a single line.
However names, types, and meaning of fields in the JSON object varies between applications.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/kubernetes/enhancements/tree/master/keps/sig-instrumentation/1602-structured-logging">Kubernetes Structured Logging proposal</a> will standardize the log format for <em>some</em> k8s components, but there will still be diverse log formats from non-k8s applications running on the cluster.</p>
</div>
<div class="sect3">
<h4 id="meta-data-and-records">Meta data and Records</h4>
<div class="paragraph">
<p>The collector creates a <em>record</em> containing the log entry and meta-data about the entry (original host, container-id, namespace, timestamp etc.)
The record follows the <a href="https://github.com/openshift/origin-aggregated-logging/blob/master/docs/com.redhat.viaq-openshift-project.asciidoc">logging data model</a>
The forwarder can be configured to modify the record to suit the application.</p>
</div>
<div class="paragraph">
<p>When a record is forwarded, it is encoded in a form expected by the consumer.
Current encodings include JSON object and rsyslog message.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Not all of the documented model is in active use. Review is needed.
The <code>labels</code> field is "flattened" before forwarding to Elasticsearch.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="multi-line-entries">Multi-line Entries</h4>
<div class="paragraph">
<p>Log entries are usually a single line of text, but they can be split over multiple lines:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CRI-O</dt>
<dd>
<p>CRI-O reads text from containers in chunks, not line-by-line. If a line is split between chunks, CRI-O writes each fragment as a separate line in the log file with a "partial" flag. The collector re-assembles the original lines.</p>
</dd>
<dt class="hdlist1">Stack traces</dt>
<dd>
<p>Programs in languages like Java, Ruby or Python often dump multi-line stack traces into the log. It is preferable to capture the entire stack trace in a single record.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="work-in-progress">Work in progress</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="proposals-under-reviewdevelopment">Proposals under review/development</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/openshift/enhancements/pull/518::">Forwarding JSON Structured Logs</a></p>
<div class="ulist">
<ul>
<li>
<p>also includes configuration for modifying log records for any output type.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/openshift/enhancements/pull/457::">Pod Label Selector</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="flow-control">Flow Control</h3>
<div class="paragraph">
<p><strong>Status</strong>: Needs write-up as <a href="https://github.com/openshift/enhancements/blob/master/guidelines/README.md">enhancement proposal(s)</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Epic <a href="https://issues.redhat.com/browse/LOG-884::">Implement proper flow control mechanisms to support more reliable log collection</a></p>
</li>
<li>
<p><a href="https://issues.redhat.com/browse/LOG-575:">Prototype code showing back-pressure on conmon</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Goal:
1) Sustain a predictable average load without log loss up to retention limits.
2) Handle <strong>temporary</strong> load spikes predictably: drop or back-pressure.
3) Handle <strong>long-term</strong> overload with alerts and predictable log loss at source.</p>
</div>
<div class="paragraph">
<p>Problems now:
- Uncontrolled (file-at-a-time) log loss from slow collection + node log rotation.
- Large back-up in file buffers under load: very high latency, slow recovery.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="flow_legend.svg" alt="flow legend">
</div>
<div class="title">Figure 4. Key to data flow diagrams.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="flow.svg" alt="flow">
</div>
<div class="title">Figure 5. Current data flow.</div>
</div>
<div class="paragraph">
<p>In the current data flow, the collector reads from log files.
The writers have back-pressure from disk write speed, but they are not affected by the speed of collector reads.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="flow2.svg" alt="flow2">
</div>
<div class="title">Figure 6. Proposed data flow for end-to-end back-pressure.</div>
</div>
<div class="paragraph">
<p>In the new data flow, CRI-O and journald write to the collector over pipes or sockets.
This creates back-pressure, their writes will block if the collector is slow to read.</p>
</div>
<div class="paragraph">
<p>Log files may still be written in parallel for other cluster tools, such as <code>oc logs</code>.</p>
</div>
<div class="paragraph">
<p>Propose 2 qualities of service:
- <em>fast</em>: priority is low latency, high throughput, no effect on apps. <em>May drop data</em>.
- <em>reliable</em>: Priority is to avoid data loss, but may allow loss outside of defined limits. <em>May slow application progress</em>.</p>
</div>
<div class="paragraph">
<p>In traditional terminology:
- <em>fast</em>: at-most-once
- <em>reliable</em>: at-least-once <em>with limits</em>. Even users who want reliable logging may have a breaking point where they&#8217;d rather let the application progress and lose logs. We may need configurable limits on how hard we try to be reliable.</p>
</div>
<div class="paragraph">
<p>Architecture:
- conmon writes container log files on node, log rotation (retention)
- fluentd on node: file vs. memory buffers
- forwarder target: throughput
- store target: retention
- Future: separate normalizer/forwarder, fluentbit/fluentd</p>
</div>
<div class="paragraph">
<p>Must consider data loss by forwarding protocol also:
- store (elasticsearch) review options.
- fluent-forward need to enable at-least-once  (we don&#8217;t)
- others need to review case by case if its possible.</p>
</div>
<div class="paragraph">
<p>Throughput and latency:
- evaluate throughput of each stage: node log to store/target.
- end-to-end latency, expected/acceptable variation.</p>
</div>
<div class="paragraph">
<p>Buffer sizes
- all components must maintain bounded buffers.
- without end-to-end back-pressure we cannot guarantee no data loss.
- we should be able to give better sizing/capacity guidelines.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Need well-designed (accurate, no floods, no noise) alerts for log loss and back-pressure situations
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration:
- Enable back-pressure by pod label and/or namespace.
  - Can&#8217;t impose back-pressure everywhere?
- Enable rate limiting in low-latency mode (back-pressure always limits rate)</p>
</div>
</div>
<div class="sect2">
<h3 id="error-reporting">Error Reporting</h3>
<div class="paragraph">
<p><strong>Status</strong>: Needs write-up as <a href="https://github.com/openshift/enhancements/blob/master/guidelines/README.md">enhancement proposal(s)</a></p>
</div>
<div class="paragraph">
<p>The logging system itself can encounter errors, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invalid log entries that cannot be forwarded.</p>
</li>
<li>
<p>Unexpected errors from logging components: fluentd, elasticsearch, other consumers.</p>
</li>
<li>
<p>Log entries not forwarded due to communication failure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are several mechanisms available, not all errors should be reported on all channels.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Resource Status</dt>
<dd>
<p>Current error conditions should be visible in the status conditions of the relevant custom resource. Examples: fluentd is unable to connect, slow consumers are causing back-pressure and/or log loss, /var/log is full on some node(s), etc.</p>
</dd>
<dt class="hdlist1">Alerts</dt>
<dd>
<p>Alerts must be <em>actionable</em> by an SRE.
Used only for severe  problems that  require a specific intervention.
They cannot be used for high-volume events or to record activity for postmortem review.</p>
</dd>
<dt class="hdlist1">K8s Events</dt>
<dd>
<p>Used to report important cluster events such as failure to pull images.
They are highly visible in the openshift console.
<strong>TODO</strong>: investigate best practices for use of K8S Events, likely similar to Alerts.</p>
</dd>
<dt class="hdlist1">Logs</dt>
<dd>
<p>The logging operators and operands generate logs like any other infrastructure.
If the logging system itself is in trouble, users need a more direct way to diagnose.
This mechanism should also be able to function during common logging problems.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Summary of proposal:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a 4th log category <em>logging</em> [application, infrastructure, audit, <em>logging</em>]</p>
</li>
<li>
<p>Review operator and operand logs, select useful entries for this category.</p>
</li>
<li>
<p>Implement so this category that that can still function under common problems:</p>
</li>
<li>
<p>store or other consumers are disconnected.</p>
</li>
<li>
<p>consumers are causing back-pressure or log loss.</p>
</li>
<li>
<p>/var/log full on some node.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="review-data-model">Review Data Model.</h3>
<div class="paragraph">
<p>Review the current <a href="https://github.com/openshift/origin-aggregated-logging/blob/master/docs/com.redhat.viaq-openshift-project.asciidoc">data model</a>, remove dead code, ensure all definitions
are relevant, current and clearly documented.</p>
</div>
</div>
<div class="sect2">
<h3 id="multi-line-support">Multi-line support</h3>
<div class="paragraph">
<p><strong>Status</strong>: Needs write-up as <a href="https://github.com/openshift/enhancements/blob/master/guidelines/README.md">enhancement proposal(s)</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cover common stack trace types: Java, Ruby, Python, Go.</p>
</li>
<li>
<p>Confirm or deny need for multi-line JSON (probably not?)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="syslog-meta-data">Syslog meta-data</h3>
<div class="paragraph">
<p><strong>Status</strong>: Needs write-up as <a href="https://github.com/openshift/enhancements/blob/master/guidelines/README.md">enhancement proposal(s)</a></p>
</div>
<div class="paragraph">
<p>Optionally copy meta-data to syslog <a href="https://tools.ietf.org/html/rfc5424#section-6.3">STRUCTURED-DATA</a></p>
</div>
</div>
<div class="sect2">
<h3 id="loki-as-store">Loki as store</h3>
<div class="paragraph">
<p><strong>Status</strong>: In progress with the explore team. Need to review current state.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bench-marking &amp; stress testing in progress</p>
</li>
<li>
<p>Configuring Loki at scale.</p>
</li>
<li>
<p>Test with back ends s3, boltd.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="observabilitytelemetry">Observability/Telemetry</h3>
<div class="paragraph">
<p><strong>TODO</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-this-page">Updating this page</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/openshift/origin-aggregated-logging/blob/master/docs/architecture/index.adoc">asciidoc source for this document</a> is on GitHub.
Create a GitHub Pull Request to request changes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Run <code>make</code> in the <code>architecture</code> directory to update the <a href="https://htmlpreview.github.io/?https://github.com/openshift/origin-aggregated-logging/blob/master/docs/architecture/index.html">pretty HTML version</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">Planning and tracking</div>
<ul>
<li>
<p><a href="https://github.com/openshift/enhancements/blob/master/guidelines/README.md">The Enhancement Proposal Process</a> is how we document &amp; discuss designs.</p>
</li>
<li>
<p><a href="{enhancement_repo}">Cluster Logging Enhancement Proposals</a> for CLO and ELO.</p>
</li>
<li>
<p><a href="https://issues.redhat.com/projects/LOG/issues/LOG-96?filter=allopenissues">JIRA project LOG</a> tracks feature work.</p>
</li>
<li>
<p><a href="https://bugzilla.redhat.com/buglist.cgi?cmdtype=runnamed&amp;list_id=11292768&amp;namedcmd=All%20Cluster%20Logging%20Bugs">Bugzilla </a> tracks bugs.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Source code</div>
<ul>
<li>
<p><a href="https://github.com/openshift/origin-aggregated-logging/blob/master/docs/architecture/index.adoc">Asciidoc source for this document</a></p>
</li>
<li>
<p><a href="https://github.com/openshift/cluster-logging-operator">Cluster Logging Operator</a></p>
</li>
<li>
<p><a href="https://github.com/openshift/elasticsearch-operator">Elasticsearch Operator</a></p>
</li>
<li>
<p><a href="https://github.com/openshift/origin-aggregated-logging">Other logging dependencies (fluentd, kibana images etc.)</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Data model</div>
<ul>
<li>
<p><a href="https://github.com/openshift/origin-aggregated-logging/blob/master/docs/com.redhat.viaq-openshift-project.asciidoc">Generated data model documentation</a></p>
</li>
<li>
<p><a href="https://github.com/ViaQ/elasticsearch-templates/tree/master/templates::">Formal Model</a> and documentation/code generators</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-11-26 09:27:08 -0500
</div>
</div>
</body>
</html>